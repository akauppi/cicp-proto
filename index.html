<!DOCTYPE html>
<html lang="en">

<!-- /login.html?[from=<url>]

The user gets forwarded here if they are not logged in. We should handle login and forward them back the the
originating page, if successful.

Note: Latest Firebase versions can be seen at:
  - https://github.com/firebase/firebase-js-sdk/releases
  - https://github.com/firebase/firebaseui-web/releases         # UI

tbd. Can we sniff the previous page from something? (not needing to give as a parameter?)
-->
<head>
  <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.1/firebaseui.css">

  <!-- From https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/appengine/standard/firebase/firenotes/frontend/index.html
  -_-_>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase-auth.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.1/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.1/firebaseui.css">
  <!_-- end --_>

  <!_-- disabled
  <link rel="stylesheet" type="text/css" href="login-style.css">
  --_>
  -->

  <title>Google CICP test</title>
</head>
<body>

<!-- Google CICP:
  "Copy and paste the snippet below at the bottom of your HTML, before other script tags."

  + modifications from https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/appengine/standard/firebase/firenotes/frontend/index.html
    to get e.g. Firebase UI in
-->
<script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/firebaseui/3.5.1/firebaseui.js"></script>

<script>
  var config = {
    apiKey: "AIzaSyAHXYOwmdVdU7vWN0pOnMkwgx_5kx2qab0",
    authDomain: "asu-181118.firebaseapp.com",
  };

  /*
  * Call to initiate the login functionality - no UI here.
  */
  function configureFirebaseLogin() {
    firebase.initializeApp(config);

    // [START state_change]
    /*
    * tbd. info here about '.onAuthStateChanged'
    */
    firebase.auth().onAuthStateChanged(function (user) {
      if (user) {
        $('#logged-out').hide();
        var name = user.displayName;

        /* If the provider gives a display name, use the name for the
        personal welcome message. Otherwise, use the user's email. */
        var welcomeName = name ? name : user.email;

        user.getIdToken().then(function (idToken) {
          userIdToken = idToken;

          /* Now that the user is authenicated, fetch the notes. */
          //fetchNotes();

          $('#user').text(welcomeName);
          $('#logged-in').show();

        });

      } else {
        $('#logged-in').hide();
        $('#logged-out').show();

      }
      // [END state_change]
    });
  }
</script>
<!-- end of Google CICP -->

<!-- Google CICP login widget -->
<script>
  // Firebase log-in widget
  function configureFirebaseLoginWidget() {
    var uiConfig = {
      'signInSuccessUrl': '/originating-page.html',    // tbd. here the originating page
      'signInOptions': [
        // Leave the lines as is for the providers you want to offer your users.
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        firebase.auth.FacebookAuthProvider.PROVIDER_ID,
        firebase.auth.TwitterAuthProvider.PROVIDER_ID,
        firebase.auth.GithubAuthProvider.PROVIDER_ID,
        firebase.auth.EmailAuthProvider.PROVIDER_ID
      ],
      // Terms of service url
      'tosUrl': '/404.html',      // "terms of service URL"
    };

    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    ui.start('#firebaseui-auth-container', uiConfig);
  }</script>
<!-- end of Google CICP login widget -->

<script>
  configureFirebaseLogin();
  configureFirebaseLoginWidget();
</script>

<!-- -->
<h1>Sign in to access</h1>
<div id="firebaseui-auth-container"></div>

</body>
